<% @breadcrumbs = [@project, @resource] %>
<% if flash[:newly_created] %>
<div id="notice">
  Resource successfully created!  Next, if you want to change this resource's fields, you'll need to add transformations.
</div>
<% end %>

<h2>Source Fields</h2>
<div class="section" style="max-height: 20em">
  <table class="list">
    <thead>
      <tr>
        <th>Field</th>
        <th>Type</th>
      </tr>
    </thead>
    <tbody>
      <% @resource.source_schema.each_with_index do |(column_name, info), i| %>
        <tr<%= " class='alt'" if i % 2 == 1 %>>
          <td><%= column_name %></td>
          <td><%= info[:db_type] %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<h2>Transformations</h2>
<div class="section">
  <% if @transformations.empty? %>
  <p>
    There are currently no transformations for this resource.
  </p>
  <% else %>
  <%= erb(:"transformations/list", :layout => false) %>
  <% end %>
  <p>
    <a href="/projects/<%= @project.id %>/resources/<%= @resource.id %>/transformations/new">Add transformation</a>
  </p>

<% if !@transformations.empty? %>
  <h3>Status</h3>
  <div class="section">
  <% if !@running_jobs.empty? %>
    <p>This resource is currently being transformed:</p>
    <%= erb(:'jobs/list', {:layout => false}, {:jobs => @running_jobs}) %>
  <% elsif !@scheduled_jobs.empty? %>
    <p>This scenario is currently scheduled to be transformed:</p>
    <%= erb(:'jobs/list', {:layout => false}, {:jobs => @scheduled_jobs}) %>
  <% else %>
    <p>
      Status: <strong><%= humanize(@resource.status) %></strong><br/>
      Last transformed at: <strong><%= @resource.transformed_at || "Never" %></strong>
    </p>
    <form method="get" action="/projects/<%= @project.id %>/resources/<%= @resource.id %>/transform">
      <p>
        <input onclick="return confirm('Are you sure?');" value="Transform now" type="submit" />
      </p>
    </form>
  <% end %>
  </div>
<% end %>
</div>

<% if @scenarios %>
<h2>Related Scenarios</h2>
<div class="section">
  <%= erb(:"scenarios/list", :layout => false) %>
</div>
<% end %>
