<%- add_javascript('jquery.dataTables.min.js') -%>
<%- add_stylesheet('dataTables.css') -%>
<%- @breadcrumbs = [@project, @scenario, @result] -%>
<h2>Groups</h2>
<div class="section">
  <p>
    There were <strong><%= groups_dataset.count %></strong> groups of records
    found.  Click on a group row to see more details.
  </p>
  <table class="summary dataTable">
    <thead>
      <tr>
        <%- (columns = groups_dataset.columns).each do |column| -%>
          <%- if column.to_s =~ /pair_(\d+)/ -%>
            <th><%= "Pair #%d" % ($1.to_i + 1) %></th>
          <%- elsif column.to_s =~ /resource_(\d+)_count/ -%>
            <th><%= "Rows from #{Coupler::Models::Resource[:id => $1].name}" %></th>
          <%- else -%>
            <th><%= column %></th>
          <%- end -%>
        <%- end -%>
      </tr>
    </thead>
    <tbody>
      <%- groups_dataset.each do |group| -%>
        <tr id="group-<%= group[:id] %>" class="group">
          <%- columns.each do |column| -%>
            <td><%= group[column] %></td>
          <%- end -%>
        </tr>
      <%- end -%>
    </tbody>
  </table>
</div>
<div id="group-details" style="display: none;"></div>

<script type="text/javascript">
  $(function() {
    $("table.summary tbody").click(function(e) {
      $(oTable.fnSettings().aoData).each(function() {
        $(this.nTr).removeClass('row_selected');
      });
      var tr = $(e.target.parentNode);
      tr.addClass('row_selected');
      var groupId = tr.attr('id').replace(/^group-/, "");
      $('#group-details').load(window.location.href + "/details/" + groupId, function() {
        $(this).show().find('table.dataTable').dataTable({bJQueryUI: true});
      });
    });
    var oTable = $('table.summary').dataTable({bJQueryUI: true});
  });
</script>
