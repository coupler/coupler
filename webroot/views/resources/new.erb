<% @breadcrumbs = [@project, @resource] %>
<%- add_javascript('jquery-ui.min.js') -%>
<%= error_messages_for @resource %>

<div class="strong">Choose a resource type:</div>
<div id="resource-type-buttons" style="padding: 1em 0 2em 2em">
  <input id="type-database" name="resource[type]" type="radio" value="database" /><label for="type-database">Database</label>
  <input id="type-csv" name="resource[type]" type="radio" value="csv" /><label for="type-csv">CSV</label>
</div>

<div id="resource-database" style="display: none">
  <form method="post" action="/projects/<%= @project.id %>/resources">
    <%- if @connections.empty? -%>
    <h2>Connection</h2>
    <table class="form">
      <tr>
        <td class="left"><label for="connection_name" class="strong">Name</label></td>
        <td>
          <input id="connection_name" name="resource[connection_attributes][name]" type="text" value="<%=h @resource.connection.name %>" />
        </td>
      </tr>
      <tr class="alt">
        <td class="left"><label for="adapter" class="strong">Type</label></td>
        <td>
          <select id="adapter" name="resource[connection_attributes][adapter]">
          <%- Coupler::Models::Connection::ADAPTERS.each do |(value, label)| -%>
            <option value="<%= value %>"<%= ' selected="selected"' if @resource.connection.adapter == value %>><%= label %></option>
          <%- end -%>
          </select>
        </td>
      </tr>
      <tr>
        <td class="left"><label for="host" class="strong">Host</label></td>
        <td>
          <input id="host" name="resource[connection_attributes][host]" type="text" value="<%=h @resource.connection.host %>" />
        </td>
      </tr>
      <tr class="alt">
        <td class="left"><label for="port" class="strong">Port</label></td>
        <td>
          <input id="port" name="resource[connection_attributes][port]" type="text" value="<%=h @resource.connection.port %>" />
        </td>
      </tr>
      <tr>
        <td class="left"><label for="username" class="strong">Username</label></td>
        <td>
          <input id="username" name="resource[connection_attributes][username]" type="text" value="<%=h @resource.connection.username %>" />
        </td>
      </tr>
      <tr class="alt">
        <td class="left"><label for="password" class="strong">Password</label><br/></td>
        <td>
          <input id="password" name="resource[connection_attributes][password]" type="password" />
        </td>
      </tr>
    </table>
    <%- end -%>
    <h2>Database</h2>
    <table class="form">
      <tr<%= cycle("", ' class="alt"') %>>
        <td class="left"><label for="name" class="strong">Name</label></td>
        <td>
          <input id="name" name="resource[name]" type="text" />
        </td>
      </tr>
      <%- if !@connections.empty? -%>
      <tr<%= cycle("", ' class="alt"') %>>
        <td class="left"><label for="connection_id" class="strong">Connection</label></td>
        <td>
          <select id="connection_id" name="resource[connection_id]">
          <%- @connections.each do |connection| -%>
            <option value="<%= connection.id %>"><%= connection.name %></option>
          <%- end -%>
          </select>
        </td>
      </tr>
      <%- end -%>
      <tr<%= cycle("", ' class="alt"') %>>
        <td class="left"><label for="database_name" class="strong">Database</label></td>
        <td>
          <input id="database_name" name="resource[database_name]" type="text" value="<%= @resource.database_name %>" />
        </td>
      </tr>
      <tr<%= cycle("", ' class="alt"') %>>
        <td class="left"><label for="table_name" class="strong">Table</label></td>
        <td>
          <input id="table_name" name="resource[table_name]" type="text" value="<%= @resource.table_name %>" />
        </td>
      </tr>
    </table>
    <p>
      <input type="submit" value="Submit" /> or <a href="/projects/<%= @project.id %>">Cancel</a>
    </p>
  </div>
</form>

<div id="resource-csv" style="display: none;">
  <form id="new-import" method="post" action="/projects/<%= @project.id %>/imports" enctype="multipart/form-data">
    <h2>CSV Import</h2>
    <p>
      <input type="file" name="import[data]" />
    </p>
  </form>
</div>

<script type="text/javascript">
  $(function() {
    $('#resource-type-buttons').buttonset();
    $('input[name=resource\\[type\\]]').change(function() {
      val = $(this).val();
      if (val == "database") {
        $('#resource-csv').fadeOut('fast', function() {
          $('#resource-database').fadeIn('fast');
        });
      }
      else if (val == "csv") {
        $('#resource-database').fadeOut('fast', function() {
          $('#resource-csv').fadeIn('fast');
        });
      }
    });
    $('input:file').change(function() {
      $('#new-import').submit();
    });
  });
</script>
